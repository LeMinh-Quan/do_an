create database my_db;
use my_db;

create table users(
    maKH varchar(20) primary key,
    HoTen varchar(255),
    email varchar(255),
    pass varchar(200),
    SDT char(10),
    VaiTro enum('admin','user') default 'user'
);
CREATE TABLE DiaChi ( 
MaKH VARCHAR(20) primary key, 
DiaChiGiaoHang ENUM('Nha', 'CongTy', 'Khac') DEFAULT 'Nha',
ChiTietDiaChi VARCHAR(255) NOT NULL,
ThanhPho VARCHAR(100),
QuanHuyen VARCHAR(100), 
PhuongXa VARCHAR(100), 
GhiChu VARCHAR(255)
);

alter table DiaChi
add constraint fk_dc FOREIGN KEY (MaKH) REFERENCES users(maKH);
/*gio hang*/
create table Cart(
    MaCart char(20) primary key,
    userid varchar(20),
    ngaytao date
);

alter table Cart
add constraint fk_c_u foreign key (userid) references users(maKH);

create table SanPham(
    MaSP char(10) primary key,
    TenSP varchar(255),
    Loai varchar(20),
    ThuongHieu varchar(100),
    MoTa varchar(255),
    GiaBan decimal(10,0),
    SoLuong int check(SoLuong>0)
);

create table CT_cart(
    MaCart char(20),
    MaSP char(10),
    SoLuong int check(SoLuong>0),
    Gia decimal(10,0)
);

alter table CT_cart
add constraint fk_ct_c foreign key (MaCart) references Cart(MaCart),
add constraint fk_ct_sp foreign key (MaSP) references SanPham(MaSP);

create table DonHang(
    MaDH char(10) primary key,
    MaKH varchar(20),
    NgayDat date,
    TongTien decimal(10,0),
    TrangThai enum('huy','Cho xac nhan','Dang Giao','Da Giao') default 'Cho xac nhan'
);

alter table DonHang
add constraint fk_dh_kh foreign key (MaKH) references users(maKH);

create table CT_donhang(
    MaDH char(10),
    MaSP char(10),
    SoLuong int check(SoLuong>0),
    DonGia decimal(10,0),
    ThanhTien decimal(10,0)
);

alter table CT_donhang
add constraint fk_ct_hd foreign key (MaDH) references DonHang(MaDH),
add constraint fk_ctdh_sp foreign key (MaSP) references SanPham(MaSP);

create table ThanhToan(
    MaTT char(10) primary key,
    MaDH char(10),
    PhuongThuc ENUM('Chuyen khoan', 'Vi dien tu', 'The tin dung', 'Tien mat') DEFAULT 'Tien mat',
    Ngayvagio datetime,
    TrangThai enum('Chua Thanh Toan','Da Thanh Toan') default 'Chua Thanh Toan'
);

alter table ThanhToan
add constraint fk_tt_dh foreign key (MaDH) references DonHang(MaDH);

create table admin(
    TKadmin varchar(20) primary key,
    PASS varchar(255),
    tenadmin varchar(200),
    email varchar(255)
);

insert into admin values
('admin','202cb962ac59075b964b07152d234b70','QUAN','0306241143@caothang.edu.vn'),
('admin2','202cb962ac59075b964b07152d234b70','SANG','0306241144@caothang.edu.vn'),
('admin3','202cb962ac59075b964b07152d234b70','TAI','0306241145@caothang.edu.vn');
	CREATE TABLE BaoCao (
    MaBC CHAR(10) PRIMARY KEY,
    NgayBaoCao DATETIME DEFAULT CURRENT_TIMESTAMP,
    TongDon INT,
    TongDoanhThu DECIMAL(12,0),
    SanPhamBanChay VARCHAR(255),
    NguoiMuaNhieu VARCHAR(255),
    GhiChu VARCHAR(255)
);

alter table SanPham 
add constraint ck_gia check(GiaBan>0);

alter table CT_Cart 
add CONSTRAINT pk_ma PRIMARY key (MaCart,MaSP);

alter table CT_donhang
add constraint pk_cthd primary key(MaDH,MaSP);

alter table admin
add constraint u_ad UNIQUE (email);

create table MoTa(
 MaSP char(10) primary key,
 CPU varchar(20),
 RAM varchar(20),
 ROM varchar(20),
 GPU varchar(20),
 ManHinh varchar(20),
 HeDieuHanh varchar(20),
 MauSac VARCHAR(20),
    ChiTiet text
);
CREATE TABLE CPU (
    MaCPU VARCHAR(20) PRIMARY KEY,
    TenCPU VARCHAR(100) NOT NULL,
    MoTa TEXT
);

CREATE TABLE RAM (
    MaRAM VARCHAR(20) PRIMARY KEY,
    DungLuong VARCHAR(50) NOT NULL,
    LoaiRAM VARCHAR(50),
    TocDo VARCHAR(50)
);
CREATE TABLE ROM (
    MaROM VARCHAR(20) PRIMARY KEY,
    DungLuong VARCHAR(50) NOT NULL,
    LoaiROM VARCHAR(50),
    MoTa TEXT
);
CREATE TABLE GPU (
    MaGPU VARCHAR(20) PRIMARY KEY,
    TenGPU VARCHAR(100) NOT NULL,
    LoaiGPU VARCHAR(50),
    MoTa TEXT
);
CREATE TABLE ManHinh (
    MaMH VARCHAR(20) PRIMARY KEY,
    KichThuoc VARCHAR(50),
    DoPhanGiai VARCHAR(50),
    TanSo VARCHAR(50),
    CongNghe VARCHAR(100)
);
CREATE TABLE HeDieuHanh (
    MaHDH VARCHAR(20) PRIMARY KEY,
    TenHDH VARCHAR(100) NOT NULL,
    PhienBan VARCHAR(50)
);
CREATE TABLE MauSac (
    MaMau VARCHAR(20) PRIMARY KEY,
    TenMau VARCHAR(50) NOT NULL,
    MaHex VARCHAR(10)
);


ALTER TABLE MoTa
ADD CONSTRAINT fk_mt FOREIGN KEY (MaSP) REFERENCES SanPham(MaSP),
ADD CONSTRAINT fk_cpu FOREIGN KEY (CPU) REFERENCES CPU(MaCPU),
ADD CONSTRAINT fk_ram FOREIGN KEY (RAM) REFERENCES RAM(MaRAM),
ADD CONSTRAINT fk_rom FOREIGN KEY (ROM) REFERENCES ROM(MaROM),
ADD CONSTRAINT fk_gpu FOREIGN KEY (GPU) REFERENCES GPU(MaGPU),
ADD CONSTRAINT fk_mh FOREIGN KEY (ManHinh) REFERENCES ManHinh(MaMH),
ADD CONSTRAINT fk_hdh FOREIGN KEY (HeDieuHanh) REFERENCES HeDieuHanh(MaHDH),
ADD CONSTRAINT fk_mau FOREIGN KEY (MauSac) REFERENCES MauSac(MaMau);

